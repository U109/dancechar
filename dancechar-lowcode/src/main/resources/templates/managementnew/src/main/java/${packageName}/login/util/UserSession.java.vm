package ${packageName}.login.util;

import ${packageName}.login.dto.DistrictDTO;
import ${packageName}.login.service.DistrictService;
import com.sf.erui.context.SpringContextUtil;
import org.apache.commons.lang3.StringUtils;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;

/**
 * 当前登录用户缓存  姓名 工号  地区code  区域 网点
 *
 * @author ${authorName}
 * @date ${createDateString}
 */
public class UserSession {
    public UserSession() {
    }

    /**
     * 员工工号
     */
    public static String getEmpNum() {
        HttpServletRequest req = getReq();
        if (req == null){
            return null;
        }
        return (String)req.getSession().getAttribute("__sf.sfopen.USER_NAME__");

    }

    /**
     * 设置员工工号
     */
    public static void setEmpNum(String empNum) {
        HttpServletRequest req = getReq();
        if (req == null){
            return;
        }
        req.getSession().setAttribute("__sf.sfopen.USER_NAME__", empNum);

    }
    
    /**
     * 设置员工姓名
     */
    public static void setEmpName(String empName) {
        HttpServletRequest req = getReq();
        if (req == null){
            return ;
        }
        req.getSession().setAttribute("__sf.sfopen.EMP_NAME__",empName);
    }
    /**
     * 获取员工姓名
     */
    public static String getEmpName() {
        HttpServletRequest req = getReq();
        if(req == null){
            return null;
        }
        return (String) req.getSession().getAttribute("__sf.sfopen.EMP_NAME__");
    }
    /**
     * 设置员工网点
     */
    public static void setEmpNetCode(String netCode) {
        HttpServletRequest req = getReq();
        if (req == null){
            return ;
        }
        req.getSession().setAttribute("__sf.sfopen.NET_CODE__",netCode);
    }
    
    /**
     * 获取员工网点
     */
    public static String getEmpNetCode() {
        HttpServletRequest req = getReq();
        if (req == null){
            return null;
        }
        return (String)  req.getSession().getAttribute("__sf.sfopen.NET_CODE__");
    }
    /**
     * 设置员工地区
     */
    public static void setEmpAreaCode(String areaCode) {
        HttpServletRequest req = getReq();
        if (req == null){
            return ;
        }
        req.getSession().setAttribute("__sf.sfopen.AREA_CODE__",areaCode);
    }
    /**
     * 获取员工地区
     */
    public static String getEmpAreaCode() {
        HttpServletRequest req = getReq();
        if (req == null){
            return null;
        }
        String empAreaCode = (String) req.getSession().getAttribute("__sf.sfopen.AREA_CODE__");
        //  调COUPON查询bdus接口获取登入人姓名 网点 地区 以及区域
        if (StringUtils.isBlank(empAreaCode)) {
            DistrictDTO districtDTO = setUserSessionCommonPara();
            empAreaCode = districtDTO.getAreaCode();
        }
        return empAreaCode;
    }
    
    /**
     * 设置员工区域
     */
    public static void setEmpDistrictFlag(String districtFlag) {
        HttpServletRequest req = getReq();
        if (req == null){
            return ;
        }
        req.getSession().setAttribute("__sf.sfopen.DISTRICT_FLAG__",districtFlag);
    }
    /**
     * 获取员工区域  1-代表区域1 0-代表区域0
     */
    public static String getEmpDistrictFlag() {
        HttpServletRequest req = getReq();
        if (req == null){
            return null;
        }
        String empDistrictFlag = (String) req.getSession().getAttribute("__sf.sfopen.DISTRICT_FLAG__");
        //  调COUPON查询bdus接口获取登入人姓名 网点 地区 以及区域
        if (StringUtils.isBlank(empDistrictFlag)) {
            DistrictDTO districtDTO = setUserSessionCommonPara();
            empDistrictFlag = districtDTO.getDistrictFlag();
        }
        return empDistrictFlag;
    }

    private static DistrictDTO setUserSessionCommonPara() {
        DistrictService districtService = (DistrictService) SpringContextUtil.getBean("districtServiceImpl");
        DistrictDTO districtDTO = districtService.getDistrictByEmpNum();
        //  存入用户session  姓名,地区，区域
        UserSession.setEmpName(districtDTO.getEmpName());
        UserSession.setEmpNetCode(districtDTO.getDeptCode());
        UserSession.setEmpAreaCode(districtDTO.getAreaCode());
        UserSession.setEmpDistrictFlag(districtDTO.getDistrictFlag());
        return districtDTO;
    }

    private static HttpServletRequest getReq(){
        RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();
        if(requestAttributes == null){
            return null;
        }
        return ((ServletRequestAttributes)requestAttributes).getRequest();
    }
}
